# 2026-02-06 生产环境更新部署文档 (最终版 - 补充)

## 1. 紧急修复说明
本次补充更新主要修复以下问题：
1.  **缓存一致性问题**：修复修改字段配置（如启用/禁用批量录入）后，子任务界面和批量录入界面未能及时生效的问题。
2.  **继承字段更新问题**：修复父试验类型字段变更后，子类型未能及时感知变化的问题。

## 2. 涉及文件清单
请将以下文件上传至服务器对应目录（覆盖原文件）：

### 后端代码 (Python)
- `apps/tasks/models.py` (增加缓存失效机制和信号处理)

## 3. 部署操作说明

### 第一步：上传文件
请将 `apps/tasks/models.py` 上传覆盖服务器上的同名文件。

### 第二步：无需迁移
本次修改仅涉及代码逻辑（增加信号和修改缓存键），不涉及数据库结构变更，因此**不需要**执行数据库迁移。

### 第三步：重启服务
为了让代码生效并清除旧的内存缓存（如果有），请重启服务。

```bash
# 重启 Gunicorn 服务
sudo systemctl restart gunicorn_lab

# 重启 Celery 服务 (如果有)
sudo systemctl restart celery_lab_worker
```

### 第四步：验证
1. 刷新页面，查看之前修改的字段是否已正确显示（例如：批量录入已启用的字段应出现在批量录入界面）。
2. 如果仍未生效，请尝试再次编辑该字段并保存一次（这会触发强制刷新）。

# 试验室管理系统项目结构及开发路线图

> **文档版本**: v1.0  
> **更新日期**: 2026-02-05  
> **项目路径**: `D:\laboratory_management`

---

## 📁 一、项目整体结构

```
laboratory_management/
├── 📂 laboratory_management/          # Django项目配置目录
│   ├── __init__.py
│   ├── settings.py                    # 项目配置文件（数据库、缓存、Celery等）
│   ├── urls.py                        # 根路由配置
│   ├── wsgi.py                        # WSGI应用入口
│   ├── asgi.py                        # ASGI应用入口
│   ├── celery.py                      # Celery异步任务配置
│   └── views.py                       # 首页和仪表盘视图
│
├── 📂 apps/                           # 应用目录（8个核心模块）
│   ├── 📂 users/                      # 用户管理模块
│   │   ├── models.py                  # User, Role, Department模型
│   │   ├── views.py                   # 用户认证、权限管理视图
│   │   ├── urls.py                    # 用户模块路由
│   │   ├── forms.py                   # 用户表单
│   │   └── migrations/                # 数据库迁移文件
│   │
│   ├── 📂 tasks/                      # 任务管理模块（核心业务）
│   │   ├── models.py                  # TestTask, SubTask, TestType等模型
│   │   ├── views.py                   # 任务管理视图
│   │   ├── urls.py                    # 任务模块路由
│   │   ├── forms.py                   # 任务表单
│   │   ├── generic_forms.py           # 通用表单
│   │   └── migrations/                # 数据库迁移文件
│   │
│   ├── 📂 test_data/                  # 试验数据模块
│   │   ├── models.py                  # 8种试验数据模型
│   │   ├── views.py                   # 数据录入视图
│   │   ├── urls.py                    # 数据模块路由
│   │   └── forms.py                   # 数据录入表单
│   │
│   ├── 📂 equipment/                  # 设备管理模块
│   │   ├── models.py                  # Equipment, EquipmentUsageRecord模型
│   │   ├── views.py                   # 设备管理视图
│   │   ├── urls.py                    # 设备模块路由
│   │   └── forms.py                   # 设备表单
│   │
│   ├── 📂 tooling/                    # 工装管理模块
│   │   ├── models.py                  # Tooling, ToolingUsageRecord模型
│   │   ├── views.py                   # 工装管理视图
│   │   ├── urls.py                    # 工装模块路由
│   │   └── forms.py                   # 工装表单
│   │
│   ├── 📂 tools/                      # 工具管理模块
│   │   ├── models.py                  # Tool, ToolBorrowRecord模型
│   │   ├── views.py                   # 工具管理视图
│   │   ├── urls.py                    # 工具模块路由
│   │   └── forms.py                   # 工具表单
│   │
│   ├── 📂 reports/                    # 报表生成模块
│   │   ├── models.py                  # ReportTemplate, GeneratedReport模型
│   │   ├── views.py                   # 报表视图
│   │   ├── urls.py                    # 报表模块路由
│   │   └── admin.py                   # 后台管理
│   │
│   └── 📂 common/                     # 通用组件模块
│       ├── models.py                  # SystemConfig, Notification, AuditLog模型
│       ├── views.py                   # 通用视图
│       ├── urls.py                    # 通用模块路由
│       └── admin.py                   # 后台管理
│
├── 📂 templates/                      # 模板目录
│   ├── base.html                      # 基础模板（Glassmorphism UI）
│   ├── base_auth.html                 # 认证页面基础模板
│   ├── index.html                     # 首页模板
│   └── 📂 registration/               # 认证模板
│       └── login.html                 # 登录页面
│
├── 📂 static/                         # 静态文件目录
│   ├── 📂 css/                        # 样式文件
│   │   ├── tokens.css                 # 设计令牌（颜色、间距等）
│   │   ├── glass.css                  # 毛玻璃效果样式
│   │   └── modal.css                  # 弹窗组件样式
│   ├── 📂 js/                         # JavaScript文件
│   │   └── modal.js                   # 弹窗组件
│   └── 📂 vendor/                     # 第三方库
│       ├── bootstrap.min.css
│       └── fontawesome.min.css
│
├── 📂 media/                          # 媒体文件目录（用户上传）
│   ├── 📂 test_outlines/              # 试验大纲文件
│   ├── 📂 test_reports/               # 试验报告文件
│   ├── 📂 task_reports/               # 任务报告文件
│   └── 📂 uploads/                    # 通用上传文件
│
├── 📂 staticfiles/                    # 收集的静态文件（生产环境）
│
├── 📂 database/                       # 数据库脚本
│   ├── 📂 exports/                    # 数据导出脚本
│   └── update_users_table.sql         # 用户表更新脚本
│
├── 📂 scripts/                        # 运维脚本
│   ├── export_users_sql.py            # 导出用户数据
│   ├── export_priority_types_sql.py   # 导出优先级类型
│   └── execute_sql.py                 # 执行SQL脚本
│
├── 📂 backups/                        # 数据库备份目录
│
├── 📂 .trae/documents/                # 项目文档
│
├── manage.py                          # Django管理脚本
├── requirements.txt                   # Python依赖清单
├── db.sqlite3                         # SQLite数据库（开发环境）
│
├── 📄 部署.md                         # 详细部署文档
├── 📄 ubuntu部署.md                   # Ubuntu部署指南（小白版）
├── 📄 上线验证清单.md                 # 上线验证检查清单
├── 📄 Redis安装指南.md                # Redis安装说明
├── 📄 Glassmorphism集成使用指南.md    # UI使用指南
├── 📄 弹窗功能实现文档.md              # 弹窗组件文档
├── 📄 子任务访问问题修复报告.md         # 问题修复记录
├── 📄 批量数据录入页面性能优化报告.md    # 性能优化文档
├── 📄 性能分析报告.md                  # Lighthouse性能分析
└── 📄 TestTask字段说明.md              # 数据模型文档
```

---

## 🏗️ 二、核心模块详解

### 2.1 用户管理模块（apps/users）

**数据模型：**
- `User` - 自定义用户模型（继承AbstractUser）
- `Role` - 角色模型（admin, manager, engineer, equipment_manager, guest）
- `Department` - 部门模型

**功能特性：**
- ✅ 用户注册/登录/登出
- ✅ JWT Token认证
- ✅ 角色权限控制（基于django-guardian的对象级权限）
- ✅ 部门管理
- ✅ 用户信息管理（工号、手机号、职位）
- ✅ 账户状态管理（冻结/正常）

### 2.2 任务管理模块（apps/tasks）

**数据模型：**
- `TestTask` - 试验任务主表
- `SubTask` - 子任务表
- `TestType` - 试验类型表（支持层级）
- `TestTypeField` - 动态字段配置表
- `TaskStatus` - 任务状态表
- `PriorityType` - 优先级表
- `GenericTestData` - 通用试验数据表
- `DiscSpringTestData` - 碟簧试验数据表
- `SubTaskData` - 子任务数据表
- `TestTaskReport` - 任务报告文件表

**功能特性：**
- ✅ 任务CRUD操作
- ✅ 自动任务编号生成（YYYYMMDD-部门-类型-序号）
- ✅ 任务状态工作流（待处理→进行中→待审核→已完成）
- ✅ 子任务分解管理
- ✅ 动态字段配置系统（支持继承和覆盖）
- ✅ 批量数据录入
- ✅ 任务逾期检测
- ✅ 进度自动计算
- ✅ 报告文件上传

### 2.3 试验数据模块（apps/test_data）

**数据模型（8种试验类型）：**
1. `AntiSlipTestData` - 防滑试验数据
2. `MetalImpactTestData` - 金属冲击试验数据
3. `MetalTensileTestData` - 金属拉伸试验数据
4. `CompressionTestData` - 压缩试验数据
5. `FatigueTestData` - 疲劳试验数据
6. `HardnessTestData` - 硬度试验数据
7. `CreepTestData` - 蠕变试验数据
8. `CorrosionTestData` - 腐蚀试验数据

**功能特性：**
- ✅ 各类试验数据录入
- ✅ 数据验证
- ✅ 试验条件记录
- ✅ 结果判定

### 2.4 设备管理模块（apps/equipment）

**数据模型：**
- `Equipment` - 设备表
- `EquipmentUsageRecord` - 设备使用记录表
- `EquipmentMaintenance` - 设备维护记录表

**功能特性：**
- ✅ 设备台账管理
- ✅ 设备使用记录
- ✅ 维护计划管理
- ✅ 保修期管理
- ✅ 维护到期提醒（is_maintenance_due）

### 2.5 工装管理模块（apps/tooling）

**数据模型：**
- `Tooling` - 工装表
- `ToolingUsageRecord` - 工装使用记录表
- `ToolingMaintenance` - 工装维护记录表

**功能特性：**
- ✅ 工装台账管理
- ✅ 工装使用记录
- ✅ 工装维护管理
- ✅ 技术参数管理（最大载荷、工作温度范围）

### 2.6 工具管理模块（apps/tools）

**数据模型：**
- `Tool` - 工具表
- `ToolBorrowRecord` - 工具借用记录表
- `ToolCalibration` - 工具校准记录表

**功能特性：**
- ✅ 工具台账管理
- ✅ 借用申请与审批
- ✅ 借用逾期检测（is_overdue）
- ✅ 校准管理
- ✅ 校准到期提醒（is_calibration_due）

### 2.7 报表管理模块（apps/reports）

**数据模型：**
- `ReportTemplate` - 报表模板表
- `GeneratedReport` - 生成的报表表
- `ReportSchedule` - 报表定时任务表
- `ReportAccess` - 报表访问记录表

**功能特性：**
- ✅ 报表模板管理
- ✅ 定时报表配置（日/周/月/季/年）
- ✅ 多格式输出配置（PDF/Excel/HTML）
- ✅ 报表访问日志
- ⚠️ 报表自动生成（框架已搭建，待完善）

### 2.8 通用模块（apps/common）

**数据模型：**
- `SystemConfig` - 系统配置表
- `Notification` - 通知表
- `AuditLog` - 审计日志表
- `FileUpload` - 文件上传记录表
- `SystemBackup` - 系统备份记录表

**功能特性：**
- ✅ 系统配置管理
- ✅ 通知系统（站内信）
- ✅ 审计日志（用户操作记录）
- ✅ 文件上传管理
- ✅ 系统备份记录

---

## ✅ 三、已开发功能清单

### 3.1 核心功能（100%完成）

| 模块 | 功能 | 状态 |
|------|------|------|
| 用户管理 | 用户认证（登录/登出/密码修改） | ✅ 完成 |
| 用户管理 | 角色权限控制（5种角色） | ✅ 完成 |
| 用户管理 | 部门管理 | ✅ 完成 |
| 任务管理 | 任务CRUD | ✅ 完成 |
| 任务管理 | 任务状态工作流 | ✅ 完成 |
| 任务管理 | 子任务管理 | ✅ 完成 |
| 任务管理 | 动态字段配置 | ✅ 完成 |
| 任务管理 | 批量数据录入 | ✅ 完成 |
| 任务管理 | 任务编号自动生成 | ✅ 完成 |
| 任务管理 | 逾期检测与进度计算 | ✅ 完成 |
| 资产管理 | 设备台账管理 | ✅ 完成 |
| 资产管理 | 工装台账管理 | ✅ 完成 |
| 资产管理 | 工具台账管理 | ✅ 完成 |
| 资产管理 | 使用记录管理 | ✅ 完成 |
| 资产管理 | 维护/校准记录 | ✅ 完成 |
| 数据管理 | 8种试验数据录入 | ✅ 完成 |
| 报表管理 | 报表模板管理 | ✅ 完成 |
| 报表管理 | 定时任务配置 | ✅ 完成 |
| 系统功能 | 通知系统 | ✅ 完成 |
| 系统功能 | 审计日志 | ✅ 完成 |
| 系统功能 | 文件上传 | ✅ 完成 |

### 3.2 UI/UX功能（100%完成）

| 功能 | 描述 | 状态 |
|------|------|------|
| Glassmorphism UI | 毛玻璃效果设计系统 | ✅ 完成 |
| 暗黑模式 | 自动适配系统主题 | ✅ 完成 |
| 响应式布局 | 适配桌面/平板/手机 | ✅ 完成 |
| 弹窗系统 | 4种消息类型弹窗 | ✅ 完成 |
| 表单美化 | Crispy Forms集成 | ✅ 完成 |
| 批量数据录入界面 | 动态表单生成 | ✅ 完成 |
| 仪表盘 | 首页数据统计展示 | ✅ 完成 |

### 3.3 性能优化（已完成）

| 优化项 | 描述 | 效果 |
|--------|------|------|
| 数据库查询优化 | select_related/prefetch_related | 减少70-80%查询 |
| 缓存机制 | Django缓存框架（5分钟缓存） | 提升响应速度 |
| 数据库索引 | 3个复合索引 | 加速常用查询 |
| 静态文件 | WhiteNoise + collectstatic | 优化资源加载 |
| GZip压缩 | middleware配置 | 减少传输大小 |

---

## 🚧 四、待开发/待完善功能

### 4.1 高优先级（核心功能完善）

#### 4.1.1 报表自动生成系统 ⚠️ 重要

**当前状态：** 框架已搭建，待完善实际生成逻辑

**待完成任务：**
- [ ] 报表生成引擎（PDF/Excel/HTML）
- [ ] 报表模板编辑器（可视化配置）
- [ ] 报表数据源配置（SQL查询构建器）
- [ ] 报表定时生成（Celery Beat集成）
- [ ] 报表邮件推送
- [ ] 报表在线预览

**技术方案：**
```python
# 建议使用的库
- pdf: ReportLab / WeasyPrint
- excel: openpyxl / xlsxwriter
- html: Jinja2模板 + 转PDF
```

#### 4.1.2 数据可视化与图表 📊

**需求描述：**
- [ ] 试验数据趋势图（折线图、柱状图）
- [ ] 任务统计图表（饼图、仪表盘）
- [ ] 设备使用率图表
- [ ] 数据对比分析图

**建议技术栈：**
- ECharts / Chart.js（前端图表库）
- Django REST API提供数据

#### 4.1.3 高级搜索与筛选 🔍

**待实现功能：**
- [ ] 多条件组合搜索（任务、设备、数据）
- [ ] 全文搜索（试验名称、描述）
- [ ] 筛选器保存与快速应用
- [ ] 搜索结果导出Excel
- [ ] 智能搜索建议（Autocomplete）

#### 4.1.4 Excel批量导入导出 📤📥

**待实现功能：**
- [ ] 任务数据批量导入
- [ ] 试验数据批量导入（支持模板下载）
- [ ] 设备/工装/工具批量导入
- [ ] 数据导出Excel（带格式）
- [ ] 导入数据验证与错误报告

### 4.2 中优先级（用户体验提升）

#### 4.2.1 工作流引擎 🔄

**需求描述：**
- [ ] 可视化流程设计器
- [ ] 审批流程配置（多级审批）
- [ ] 流程节点权限控制
- [ ] 审批历史记录
- [ ] 流程监控与管理

**适用场景：**
- 任务审核流程
- 工具借用审批
- 报告审核流程

#### 4.2.2 消息推送与通知 📱

**待完善功能：**
- [ ] WebSocket实时通知
- [ ] 邮件通知模板
- [ ] 短信通知（可选）
- [ ] 通知偏好设置
- [ ] 消息已读/未读状态
- [ ] 消息历史记录

#### 4.2.3 日历视图与甘特图 📅

**功能需求：**
- [ ] 任务日历视图（月/周/日）
- [ ] 设备预约日历
- [ ] 项目甘特图
- [ ] 日历事件提醒
- [ ] 拖拽调整时间

#### 4.2.4 移动端适配优化 📲

**当前问题：**
- 部分页面移动端体验不佳
- 表格在手机上显示不完整

**待优化：**
- [ ] 响应式表格（横向滚动或卡片式）
- [ ] 移动端导航优化
- [ ] 触摸友好的表单控件
- [ ] PWA支持（可选）

### 4.3 低优先级（系统增强）

#### 4.3.1 前端性能优化 🚀

**基于Lighthouse报告的优化建议：**

| 优化项 | 当前分数 | 目标分数 | 实施难度 |
|--------|----------|----------|----------|
| 消除渲染阻塞资源 | 78 | 90+ | 中 |
| 移除重复CSS/JS | - | - | 低 |
| 启用CDN加速 | - | - | 低 |
| 图片懒加载 | - | - | 低 |
| 资源合并压缩 | - | - | 中 |

**具体任务：**
- [ ] 内联关键CSS
- [ ] 异步加载非关键CSS
- [ ] 移除重复的Bootstrap/Font Awesome引用
- [ ] 配置长期缓存策略
- [ ] 启用HTTP/2

#### 4.3.2 安全增强 🔒

**待实施：**
- [ ] HTTPS强制跳转（生产环境）
- [ ] 双因素认证（2FA）
- [ ] 登录失败锁定（防暴力破解）
- [ ] 敏感数据加密存储
- [ ] SQL注入防护增强
- [ ] XSS防护增强
- [ ] CSRF Token优化
- [ ] 安全审计报告

#### 4.3.3 系统监控与告警 📊

**待开发：**
- [ ] 系统健康检查API
- [ ] 性能监控仪表板
- [ ] 错误日志集中管理
- [ ] 异常告警（邮件/短信）
- [ ] 用户行为分析
- [ ] 系统资源监控（CPU/内存/磁盘）

#### 4.3.4 数据库优化 🗄️

**长期优化：**
- [ ] 数据库读写分离
- [ ] 数据库表分区（大数据量时）
- [ ] 定期数据归档
- [ ] 慢查询优化
- [ ] 连接池优化

#### 4.3.5 测试覆盖 🧪

**当前状态：** 测试文件存在但覆盖率未知

**待完善：**
- [ ] 单元测试（目标覆盖率>80%）
- [ ] 集成测试
- [ ] 端到端测试（Selenium/Playwright）
- [ ] 性能测试脚本
- [ ] 自动化测试CI/CD

#### 4.3.6 API文档与接口开放 📚

**待完成：**
- [ ] Swagger/OpenAPI文档
- [ ] API版本管理
- [ ] 接口限流（Rate Limiting）
- [ ] API访问日志
- [ ] 第三方接口对接（可选）

### 4.4 可选功能（未来规划）

#### 4.4.1 物联网集成 📡
- [ ] 设备状态实时监控
- [ ] 试验数据自动采集
- [ ] 传感器数据接入
- [ ] 设备远程控制

#### 4.4.2 AI智能分析 🤖
- [ ] 试验数据异常检测
- [ ] 故障预测
- [ ] 智能推荐（试验参数优化）
- [ ] 自然语言查询

#### 4.4.3 多语言支持 🌍
- [ ] i18n国际化
- [ ] 中英文切换
- [ ] 多语言文档

#### 4.4.4 移动端App 📱
- [ ] Flutter/React Native开发
- [ ] 离线数据录入
- [ ] 扫码查询
- [ ] 推送通知

---

## 📋 五、开发优先级建议

### 第一阶段（1-2周）- 高优先级
1. ✅ 修复现有Bug（子任务访问权限等）
2. 🎯 报表自动生成系统（核心功能）
3. 🎯 Excel批量导入导出（数据迁移需求）
4. 🎯 高级搜索与筛选（提升效率）

### 第二阶段（2-4周）- 中优先级
1. 📊 数据可视化图表
2. 📅 日历视图与甘特图
3. 🔄 工作流引擎（审批流程）
4. 📱 移动端适配优化

### 第三阶段（4-8周）- 低优先级
1. 🚀 前端性能优化
2. 🔒 安全增强
3. 📊 系统监控与告警
4. 🧪 测试覆盖提升

### 第四阶段（长期规划）- 可选功能
1. 📡 物联网集成
2. 🤖 AI智能分析
3. 🌍 多语言支持
4. 📱 移动端App

---

## 🛠️ 六、技术债务与优化建议

### 6.1 当前技术债务

| 问题 | 影响 | 建议解决方案 |
|------|------|-------------|
| 静态文件404错误 | 样式丢失 | 检查Nginx配置和collectstatic |
| Redis依赖（可选） | Windows部署困难 | 使用本地内存缓存作为备选 |
| 缺少自动化测试 | 回归风险 | 逐步补充单元测试 |
| 前端资源未优化 | 加载慢 | 实施Lighthouse优化建议 |

### 6.2 架构优化建议

1. **微服务化（长期）**
   - 将报表生成拆分为独立服务
   - 文件处理服务化
   - 通知服务独立

2. **前后端分离（可选）**
   - 使用Vue.js/React开发SPA
   - Django仅提供API
   - 更好的前端体验

3. **缓存策略优化**
   - Redis集群（高并发时）
   - 页面级缓存
   - API响应缓存

---

## 📝 七、文档与维护

### 7.1 需要完善的文档

- [ ] API接口文档（Swagger）
- [ ] 用户操作手册
- [ ] 管理员手册
- [ ] 开发规范文档
- [ ] 数据库设计文档（ER图）
- [ ] 部署运维手册

### 7.2 定期维护任务

**每日：**
- 检查系统日志
- 监控错误率

**每周：**
- 数据库备份验证
- 性能指标检查

**每月：**
- 安全漏洞扫描
- 依赖包更新
- 数据清理（过期日志）

**每季度：**
- 全量数据备份
- 灾难恢复演练
- 用户反馈收集与分析

---

## 🎯 八、总结

### 项目现状
- **完成度：** 约70-80%（核心功能已完成）
- **技术栈：** Django + Bootstrap + MySQL/Redis + Celery
- **代码质量：** 良好，遵循Django最佳实践
- **文档完善度：** 中等（部署文档详细，开发文档待完善）

### 下一步建议
1. **立即行动：** 完成报表生成系统（核心需求）
2. **短期目标：** Excel导入导出 + 数据可视化
3. **中期目标：** 移动端优化 + 工作流引擎
4. **长期目标：** 性能优化 + 安全增强 + 智能化

### 资源需求估算
- **高优先级功能：** 2-4周，1-2名开发人员
- **中优先级功能：** 4-8周，1-2名开发人员
- **低优先级优化：** 8-12周，1名开发人员

---

**文档维护：** 建议每月更新一次，记录新增功能和待办事项变更
